<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Peter Verboon and Roeslan Leontjevas" />

<meta name="date" content="2018-10-11" />

<title>Appendix of tutorial analyzing cyclic models</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>



<link href="data:text/css;charset=utf-8,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23header%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%20code%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" rel="stylesheet" type="text/css" />

</head>

<body>




<h1 class="title toc-ignore">Appendix of tutorial analyzing cyclic models</h1>
<h4 class="author"><em>Peter Verboon and Roeslan Leontjevas</em></h4>
<h4 class="date"><em>2018-10-11</em></h4>



<div id="section" class="section level3">
<h3>—————————————————————————</h3>
</div>
<div id="preliminary-steps" class="section level3">
<h3>Preliminary Steps</h3>
<p>There are three functions used in this appendix, which are in the R package <code>cyclic</code>. This package can be installed from Github by running the following command in R:</p>
<p><code>devtools::install_github(&quot;PeterVerboon/cyclicpkg/cyclic&quot;)</code></p>
<p>The package is then activated by running:</p>
<p><code>require(cyclic)</code>.</p>
<p>The package consists of three functions. The function <code>fitCyclic()</code> fits a linear model with <code>lm()</code> to obtain cyclic parameters. <br> The function <code>fitCyclicMLA()</code> fits a MLA model with <code>lmer()</code> from the lme4 package to obtain cyclic parameters. <br> The function <code>cycpar()</code> is an auxiliary function, whch computes the cyclic parameters from the linear model parameters. <br></p>
<p>These functions should be helpful for applying a cyclic model to your data. The functions have methods for printing the results and plotting the fitted cyclic patterns.</p>
<p>  As an illustration of a cyclic process we generate perfect cyclic data and construct Figure 1 with these data using the following code. The package ggplot2 (loaded with “cyclic”) is used for plotting.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">a0 &lt;-<span class="st"> </span><span class="dv">1</span>;
b1 &lt;-<span class="st"> </span><span class="dv">2</span>;
b2 &lt;-<span class="st"> </span><span class="dv">10</span>;
P &lt;-<span class="st"> </span><span class="dv">24</span>;

T &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">24</span>, <span class="dt">by =</span><span class="fl">0.1</span>);
y &lt;-<span class="st"> </span>a0 <span class="op">+</span><span class="st"> </span>b1<span class="op">*</span><span class="kw">cos</span>(<span class="dv">2</span><span class="op">*</span>(pi<span class="op">/</span>P)<span class="op">*</span>(T <span class="op">-</span><span class="st"> </span>b2)) 

g &lt;-<span class="st"> </span><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x=</span>T, <span class="dt">y=</span>y)) ;
g &lt;-<span class="st"> </span>g <span class="op">+</span><span class="st"> </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Time points&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Dependent variable &quot;</span>);
g &lt;-<span class="st"> </span>g <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">axis.text =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">10</span>, <span class="dt">colour=</span><span class="st">&quot;black&quot;</span>));
g &lt;-<span class="st"> </span>g <span class="op">+</span><span class="st"> </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dv">0</span>,<span class="dv">24</span>,<span class="dv">2</span>)) ;
g &lt;-<span class="st"> </span>g <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x=</span>b2, <span class="dt">y=</span><span class="kw">seq</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="fl">0.1</span>)), <span class="dt">lty=</span><span class="st">&quot;dashed&quot;</span>) ;
g &lt;-<span class="st"> </span>g <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x=</span><span class="kw">seq</span>(<span class="dv">0</span>,<span class="dv">24</span>,<span class="fl">0.1</span>), <span class="dt">y=</span>a0)) ;
g &lt;-<span class="st"> </span>g <span class="op">+</span><span class="st"> </span><span class="kw">annotate</span>(<span class="st">&quot;text&quot;</span>, <span class="dt">x =</span> <span class="dv">1</span>, <span class="dt">y =</span> <span class="fl">1.2</span>, <span class="dt">label =</span> <span class="st">&quot;b0&quot;</span>);
g &lt;-<span class="st"> </span>g <span class="op">+</span><span class="st"> </span><span class="kw">annotate</span>(<span class="st">&quot;text&quot;</span>, <span class="dt">x =</span> <span class="fl">10.8</span>, <span class="dt">y =</span> <span class="dv">2</span>, <span class="dt">label =</span> <span class="st">&quot;b1&quot;</span>);
g &lt;-<span class="st"> </span>g <span class="op">+</span><span class="st"> </span><span class="kw">annotate</span>(<span class="st">&quot;text&quot;</span>, <span class="dt">x =</span> <span class="dv">10</span>, <span class="dt">y =</span> <span class="fl">0.8</span>, <span class="dt">label =</span> <span class="st">&quot;b2&quot;</span>);
g</code></pre></div>
<p> </p>
</div>
<div id="the-smoking-data" class="section level3">
<h3>The “smoking” data</h3>
<p>The “smoking” data are in the object <code>smokingdat.rda</code>. This is a dataframe, which contains a selection of variables from a larger data file (for more information about the data, see Bolman et al., 2018). Check the names in the dataframe and then put the data in dat1, the first data set used in the analysis.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(<span class="st">&quot;smokedat&quot;</span>)
<span class="kw">names</span>(smokedat)</code></pre></div>
<pre><code>## [1] &quot;subjnr&quot;         &quot;beepnr&quot;         &quot;daynr&quot;          &quot;positiveAffect&quot;
## [5] &quot;intention&quot;      &quot;stress&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat1 &lt;-<span class="st"> </span>smokedat
nall &lt;-<span class="st"> </span><span class="kw">length</span>(<span class="kw">unique</span>(dat1<span class="op">$</span>subjnr))</code></pre></div>
<p>Count the number of records per subject and remove subjects with less than 50 records. The resulting data.frame is called dat3.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat1<span class="op">$</span>count &lt;-<span class="st"> </span><span class="dv">1</span>
dat2 &lt;-<span class="st"> </span><span class="kw">aggregate</span>(dat1[,<span class="kw">c</span>(<span class="st">&quot;count&quot;</span>)],<span class="dt">by=</span><span class="kw">list</span>(dat1<span class="op">$</span>subjnr), <span class="dt">FUN=</span>sum, <span class="dt">na.rm=</span>T);
dat2<span class="op">$</span>subjnr &lt;-<span class="st"> </span>dat2<span class="op">$</span>Group.<span class="dv">1</span>
dat1<span class="op">$</span>count &lt;-<span class="st"> </span><span class="ot">NULL</span>;
dat2<span class="op">$</span>count &lt;-<span class="st"> </span>dat2[,<span class="dv">2</span>]

dat3 &lt;-<span class="st"> </span><span class="kw">merge</span>(dat1,dat2[,<span class="kw">c</span>(<span class="st">&quot;subjnr&quot;</span>,<span class="st">&quot;count&quot;</span>)], <span class="dt">by.x =</span> <span class="st">&quot;subjnr&quot;</span>)
<span class="kw">rm</span>(dat2)

dat3 &lt;-<span class="st"> </span><span class="kw">subset</span>(dat3, dat3<span class="op">$</span>count <span class="op">&gt;=</span><span class="st"> </span><span class="dv">50</span>)
nfew &lt;-<span class="st"> </span>nall <span class="op">-</span><span class="st"> </span><span class="kw">length</span>(<span class="kw">unique</span>(dat3<span class="op">$</span>subjnr))</code></pre></div>
<p>We also compute variability of intention per subject and remove subjects with very small variation in intention. The result is also in dat3.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat2 &lt;-<span class="st"> </span><span class="kw">aggregate</span>(dat3<span class="op">$</span>intention,<span class="dt">by=</span><span class="kw">list</span>(dat3<span class="op">$</span>subjnr), <span class="dt">FUN=</span>sd, <span class="dt">na.rm=</span>F)
dat2<span class="op">$</span>subjnr &lt;-<span class="st"> </span>dat2<span class="op">$</span>Group.<span class="dv">1</span>
dat2<span class="op">$</span>Group.<span class="dv">1</span> &lt;-<span class="st"> </span><span class="ot">NULL</span>
dat2 &lt;-<span class="st"> </span><span class="kw">merge</span>(dat3, dat2,  <span class="dt">by.x =</span> <span class="st">&quot;subjnr&quot;</span>)
dat3 &lt;-<span class="st"> </span><span class="kw">subset</span>(dat2, dat2<span class="op">$</span>V1 <span class="op">&gt;</span><span class="st"> </span>.<span class="dv">10</span>)  
<span class="kw">rm</span>(dat2)
nunique &lt;-<span class="st"> </span><span class="kw">length</span>(<span class="kw">unique</span>(dat3<span class="op">$</span>subjnr))
nsmall &lt;-<span class="st"> </span>(nall <span class="op">-</span><span class="st"> </span>nfew) <span class="op">-</span><span class="st"> </span>nunique</code></pre></div>
<p>The result of these steps are sumarized below.</p>
<pre><code>##  Number of subjects in data set:               49  
##  Number of subjects with less than 50 records:  8  
##  Number of subjects with SD smaller than .10:   3  
##  Number of subjects used in analysis:          38</code></pre>
<p>The next step is to construct a dataset that is aggregated over subjects, which is called dat4. This dataframe will be used in subsequent analyses.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat4 &lt;-<span class="st"> </span><span class="kw">aggregate</span>(dat3[,<span class="kw">c</span>(<span class="st">&quot;positiveAffect&quot;</span>,<span class="st">&quot;stress&quot;</span>,<span class="st">&quot;intention&quot;</span>)],
                  <span class="dt">by=</span><span class="kw">list</span>(dat3<span class="op">$</span>beepnr,dat3<span class="op">$</span>daynr), <span class="dt">FUN=</span>mean, <span class="dt">na.rm=</span>F);    
dat4<span class="op">$</span>daynr &lt;-<span class="st"> </span>dat4<span class="op">$</span>Group.<span class="dv">2</span>
dat4<span class="op">$</span>beepnr &lt;-<span class="st"> </span>dat4<span class="op">$</span>Group.<span class="dv">1</span>
dat4<span class="op">$</span>Group.<span class="dv">1</span> &lt;-<span class="st"> </span><span class="ot">NULL</span>
dat4<span class="op">$</span>Group.<span class="dv">2</span> &lt;-<span class="st"> </span><span class="ot">NULL</span></code></pre></div>
<p> </p>
</div>
<div id="single-level-analyses" class="section level3">
<h3>Single-level Analyses</h3>
<div id="step-1" class="section level4">
<h4>Step 1</h4>
<p>The raw data for three subjects and average are plotted. We have to repeat step 1 for the aggregated data in dat4, and for subjects 2, 15 and 18. This makes Figure 2 from the tutorial.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pdat &lt;-<span class="st"> </span>dat4                                         <span class="co"># averaged over all subjects</span>
pdat &lt;-<span class="st"> </span><span class="kw">subset</span>(dat3, dat3<span class="op">$</span>subjnr <span class="op">==</span><span class="st"> </span><span class="dv">2</span>)               <span class="co"># ppn 2, 15, 18 selected for Figure 1</span>
                                                      
npoints &lt;-<span class="st"> </span><span class="kw">dim</span>(pdat)[<span class="dv">1</span>]
x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span>npoints)
pdat<span class="op">$</span>day &lt;-<span class="st"> </span><span class="kw">as.factor</span>(pdat<span class="op">$</span>daynr)

g &lt;-<span class="st"> </span><span class="kw">ggplot</span>(pdat,<span class="kw">aes</span>(<span class="dt">x=</span>x, <span class="dt">y=</span>pdat<span class="op">$</span>intention, <span class="dt">colour=</span>pdat<span class="op">$</span>day)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">     </span><span class="kw">scale_x_discrete</span>(<span class="dt">name =</span><span class="st">&quot;Time points (beeps within days)&quot;</span>,  <span class="dt">labels=</span>pdat<span class="op">$</span>beepnr, <span class="dt">limits=</span><span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span>npoints)) <span class="op">+</span>
<span class="st">     </span><span class="kw">theme</span>(<span class="dt">axis.text =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">6</span>, <span class="dt">colour=</span><span class="st">&quot;black&quot;</span>),<span class="dt">legend.position=</span><span class="st">&quot;none&quot;</span>) 
g</code></pre></div>
<p> </p>
</div>
<div id="step-2" class="section level4">
<h4>Step 2</h4>
<p>Now we analyze the cyclic model and plot the result, again for the average and for subjects 2, 15, and 18. This is Figure 3 from the tutorial.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">model_a &lt;-<span class="st"> </span><span class="kw">fitCyclic</span>(pdat,<span class="dt">yvar =</span> <span class="st">&quot;intention&quot;</span>,  <span class="dt">xvar =</span><span class="st">&quot;beepnr&quot;</span>, <span class="dt">grp =</span> <span class="st">&quot;daynr&quot;</span>, 
                     <span class="dt">ymin =</span> <span class="op">-</span><span class="fl">2.5</span>, <span class="dt">ymax =</span> <span class="fl">1.5</span>, <span class="dt">step=</span>.<span class="dv">30</span>)
<span class="kw">print</span>(model_a)
<span class="kw">plot</span>(model_a, <span class="dt">type =</span> <span class="kw">c</span>(<span class="st">&quot;raw&quot;</span>,<span class="st">&quot;means&quot;</span>))</code></pre></div>
<p> </p>
</div>
<div id="step-3" class="section level4">
<h4>Step 3</h4>
<p>Fit an extra term in the model with day as covariate in aggregated data. Show the parameters and the fit of the model.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">model_b &lt;-<span class="st"> </span><span class="kw">fitCyclic</span>(dat4,  <span class="dt">yvar =</span> <span class="st">&quot;intention&quot;</span>, <span class="dt">xvar =</span><span class="st">&quot;beepnr&quot;</span>,<span class="dt">grp =</span> <span class="st">&quot;daynr&quot;</span>, 
                     <span class="dt">cov =</span> <span class="st">&quot;daynr&quot;</span>, <span class="dt">ymin=</span><span class="op">-</span><span class="fl">0.5</span>, <span class="dt">ymax=</span><span class="fl">0.5</span>)

<span class="kw">print</span>(model_b)</code></pre></div>
<p> </p>
</div>
<div id="step-4" class="section level4">
<h4>Step 4</h4>
<p>Apply the cylic model with daily period for the variables stress and positive affect for subject 15 to obtain a plot of the raw data with the fitted cycles and a plot of the aggregated data. Together with intention (model_a) this makes Figure 4.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pdat &lt;-<span class="st"> </span><span class="kw">subset</span>(dat3, dat3<span class="op">$</span>subjnr <span class="op">==</span><span class="st"> </span><span class="dv">15</span>)   

model_c &lt;-<span class="st"> </span><span class="kw">fitCyclic</span>(pdat,<span class="dt">yvar =</span> <span class="st">&quot;stress&quot;</span>, <span class="dt">xvar =</span><span class="st">&quot;beepnr&quot;</span>, <span class="dt">grp =</span> <span class="st">&quot;daynr&quot;</span>, 
                     <span class="dt">ymin =</span> <span class="op">-</span><span class="fl">1.0</span>, <span class="dt">ymax =</span> <span class="fl">0.5</span>, <span class="dt">step=</span> <span class="fl">0.25</span>)
<span class="kw">plot</span>(model_c, <span class="dt">type =</span> <span class="kw">c</span>(<span class="st">&quot;raw&quot;</span>,<span class="st">&quot;means&quot;</span>))
model_c &lt;-<span class="st"> </span><span class="kw">fitCyclic</span>(pdat,<span class="dt">yvar =</span> <span class="st">&quot;positiveAffect&quot;</span>, <span class="dt">xvar =</span><span class="st">&quot;beepnr&quot;</span>, <span class="dt">grp =</span> <span class="st">&quot;daynr&quot;</span>, 
                     <span class="dt">ymin =</span> <span class="op">-</span><span class="fl">1.0</span>, <span class="dt">ymax =</span> <span class="fl">0.5</span>, <span class="dt">step=</span> <span class="fl">0.25</span>)
<span class="kw">plot</span>(model_c, <span class="dt">type =</span> <span class="kw">c</span>(<span class="st">&quot;raw&quot;</span>,<span class="st">&quot;means&quot;</span>))</code></pre></div>
<p> </p>
</div>
<div id="step-5" class="section level4">
<h4>Step 5</h4>
<p>Apply, only for subject 15, the cylic model with a weekly period for intention, stress and positive affect, instead of a daily period. Below the code is given which produces the six separate plots of Figure 5.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pdat &lt;-<span class="st"> </span><span class="kw">subset</span>(dat3, dat3<span class="op">$</span>subjnr <span class="op">==</span><span class="st"> </span><span class="dv">15</span>)   

model_d &lt;-<span class="st"> </span><span class="kw">fitCyclic</span>(pdat, <span class="dt">yvar =</span> <span class="st">&quot;intention&quot;</span>, <span class="dt">xvar =</span><span class="st">&quot;daynr&quot;</span>, <span class="dt">grp =</span> <span class="st">&quot;daynr&quot;</span>, 
                     <span class="dt">ymin =</span> <span class="op">-</span><span class="fl">2.0</span>, <span class="dt">ymax =</span> <span class="fl">1.0</span>, <span class="dt">step=</span> <span class="fl">0.25</span>)

<span class="kw">plot</span>(model_d, <span class="dt">type =</span> <span class="kw">c</span>(<span class="st">&quot;raw&quot;</span>,<span class="st">&quot;means&quot;</span>)
model_d &lt;-<span class="st"> </span><span class="kw">fitCyclic</span>(pdat, <span class="dt">yvar =</span> <span class="st">&quot;stress&quot;</span>, <span class="dt">xvar =</span><span class="st">&quot;daynr&quot;</span>, <span class="dt">grp =</span> <span class="st">&quot;daynr&quot;</span>, 
                     <span class="dt">ymin =</span> <span class="op">-</span><span class="fl">2.0</span>, <span class="dt">ymax =</span> <span class="fl">1.0</span>, <span class="dt">step=</span> <span class="fl">0.25</span>)

<span class="kw">plot</span>(model_d, <span class="dt">type =</span> <span class="kw">c</span>(<span class="st">&quot;raw&quot;</span>,<span class="st">&quot;means&quot;</span>)
model_d &lt;-<span class="st"> </span><span class="kw">fitCyclic</span>(pdat, <span class="dt">yvar =</span> <span class="st">&quot;positiveAffect&quot;</span>, <span class="dt">xvar =</span><span class="st">&quot;daynr&quot;</span>, <span class="dt">grp =</span> <span class="st">&quot;daynr&quot;</span>, 
                     <span class="dt">ymin =</span> <span class="op">-</span><span class="fl">2.0</span>, <span class="dt">ymax =</span> <span class="fl">1.0</span>, <span class="dt">step=</span> <span class="fl">0.25</span>)
<span class="kw">plot</span>(model_d, <span class="dt">type =</span> <span class="kw">c</span>(<span class="st">&quot;raw&quot;</span>,<span class="st">&quot;means&quot;</span>)</code></pre></div>
<p> </p>
</div>
</div>
<div id="multilevel-analyses" class="section level3">
<h3>Multilevel Analyses</h3>
<div id="step-6" class="section level4">
<h4>Step 6</h4>
<p>Analyze the data with the cyclic model using MLA and model comparison. Each consecutive model is more complex. The intraclass correlation is computed with the null model (model1). This is the first model that is fitted on the data.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">model1 &lt;-<span class="st"> </span><span class="kw">fitCyclicMLA</span>(<span class="dt">dat=</span>dat3, <span class="dt">yvar=</span><span class="st">&quot;intention&quot;</span>, <span class="dt">id =</span> <span class="st">&quot;subjnr&quot;</span>)
<span class="kw">print</span>(model1)</code></pre></div>
<p>The next two models fit a daily cycle to the data. Model2 with ony the intecept as random term and model3 includes the cyclic terms as random effects.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">model2 &lt;-<span class="st"> </span><span class="kw">fitCyclicMLA</span>(<span class="dt">dat=</span>dat3, <span class="dt">yvar=</span><span class="st">&quot;intention&quot;</span>, <span class="dt">xvar1=</span><span class="st">&quot;beepnr&quot;</span>,<span class="dt">xvar2=</span><span class="st">&quot;daynr&quot;</span>, <span class="dt">id =</span> <span class="st">&quot;subjnr&quot;</span>, 
                       <span class="dt">ncycle =</span> <span class="dv">1</span>, <span class="dt">random =</span> <span class="st">&quot;intercept&quot;</span> )
<span class="kw">print</span>(model2)

model3 &lt;-<span class="st"> </span><span class="kw">fitCyclicMLA</span>(<span class="dt">dat=</span>dat3, <span class="dt">yvar=</span><span class="st">&quot;intention&quot;</span>, <span class="dt">xvar1=</span><span class="st">&quot;beepnr&quot;</span>,<span class="dt">xvar2=</span><span class="st">&quot;daynr&quot;</span>, <span class="dt">id =</span> <span class="st">&quot;subjnr&quot;</span>, 
                      <span class="dt">ncycle =</span> <span class="dv">1</span>, <span class="dt">random =</span> <span class="st">&quot;first&quot;</span>)
<span class="kw">print</span>(model3)
<span class="kw">plot</span>(model3)</code></pre></div>
<p>Model 4 and 5 are fitting two cyclic process: patterns within days and patterns within weeks. In model 5 every effect is assumed to be random, whereas in model 4 only the within days cyclic terms are assumed random. Plotting model 5 gives a plot as is shown in Figure 6.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">model4 &lt;-<span class="st"> </span><span class="kw">fitCyclicMLA</span>(<span class="dt">dat=</span>dat3, <span class="dt">yvar=</span><span class="st">&quot;intention&quot;</span>, <span class="dt">xvar1=</span><span class="st">&quot;beepnr&quot;</span>, <span class="dt">xvar2=</span><span class="st">&quot;daynr&quot;</span>,<span class="dt">id =</span> <span class="st">&quot;subjnr&quot;</span>, 
                        <span class="dt">ncycle =</span> <span class="dv">2</span>, <span class="dt">random =</span> <span class="st">&quot;first&quot;</span>)
<span class="kw">print</span>(model4)

model5 &lt;-<span class="st"> </span><span class="kw">fitCyclicMLA</span>(<span class="dt">dat=</span>dat3, <span class="dt">yvar=</span><span class="st">&quot;intention&quot;</span>, <span class="dt">xvar1=</span><span class="st">&quot;beepnr&quot;</span>, <span class="dt">xvar2=</span><span class="st">&quot;daynr&quot;</span>,<span class="dt">id =</span> <span class="st">&quot;subjnr&quot;</span>,
                       <span class="dt">ncycle =</span> <span class="dv">2</span>, <span class="dt">random =</span> <span class="st">&quot;all&quot;</span>, <span class="dt">ymin =</span> <span class="op">-</span><span class="fl">0.5</span>, <span class="dt">ymax =</span> <span class="fl">0.5</span>, <span class="dt">step=</span><span class="fl">0.10</span> )
<span class="kw">print</span>(model5)
<span class="kw">plot</span>(model5)      </code></pre></div>
<p>Model 6 also contains covariate. Finally all models are compared with each other, this is shown in table 1.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">model6 &lt;-<span class="st"> </span><span class="kw">fitCyclicMLA</span>(<span class="dt">dat=</span>dat3, <span class="dt">yvar=</span><span class="st">&quot;intention&quot;</span>, <span class="dt">xvar1=</span><span class="st">&quot;beepnr&quot;</span>, <span class="dt">xvar2=</span><span class="st">&quot;daynr&quot;</span>,<span class="dt">id =</span> <span class="st">&quot;subjnr&quot;</span>, 
                      <span class="dt">cov =</span> <span class="st">&quot;stress&quot;</span>, <span class="dt">ncycle =</span> <span class="dv">2</span>, <span class="dt">random =</span> <span class="st">&quot;all&quot;</span> )
<span class="kw">print</span>(model6)

<span class="kw">anova</span>(model6<span class="op">$</span>fit, model5<span class="op">$</span>fit, model4<span class="op">$</span>fit,model3<span class="op">$</span>fit, model2<span class="op">$</span>fit, model1<span class="op">$</span>fit)  </code></pre></div>
</div>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
